<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>notes-ch4-3.md</title>
    <!-- MathJax for LaTeX support -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            }
        };
    </script>
    <style>
        /* Pygments Syntax Highlighting */
        pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */

        /* Base CSS from markdown_styles.py */
        
        /* Basic reset and fonts */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            padding: 0;
            background-color: #f8f9fa;
        }

        /* Navigation styling */
        .nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #e1e4e8;
        }

        .nav span {
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav .activenav {
            background-color: #f1f8ff;
        }

        .nav .activenav a {
            color: #0366d6;
            text-decoration: none;
        }

        .nav .activenav a:hover {
            text-decoration: underline;
        }

        .nav .inactivenav {
            color: #959da5;
            background-color: #f6f8fa;
        }

        /* Center column layout */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem 3rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Typography */
        h1 {
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
            color: #34495e;
        }

        h3 {
            font-size: 1.5rem;
            margin: 1.8rem 0 1rem;
            color: #34495e;
        }

        h4 {
            font-size: 1.3rem;
            margin: 1.5rem 0 0.8rem;
            color: #34495e;
        }

        h5 {
            font-size: 1.1rem;
            margin: 1.2rem 0 0.8rem;
            color: #34495e;
        }

        /* Table of Contents styling */
        .table-of-contents {
            margin: 0 0 0;
            line-height: 1;
        }

        .toc-list {
            margin: 0;
            padding-left: 20px;
        }

        .toc-list li {
            margin-bottom: 2px;
        }
        .toc-list ul {
            margin-bottom: 2px;
        }

        .exercise-list {
            margin: 0;
            padding-left: 0;
            font-size: 0.95em;
            display: inline;
        }

        .exercise-container {
            display: inline-block;
            margin-top: 2px;
            line-height: 1.2;
        }

        .toc-exercises {
            font-style: italic;
            color: #555;
        }

        .exercise-list a {
            text-decoration: none;
            color: #2070b0;
            margin-right: 0;
        }

        .exercise-list a:hover {
            text-decoration: underline;
        }

        .exercise-list span:not(:last-child):after {
            content: ", ";
            color: #777;
            margin-right: 0;
        }

        /* Blockquote styling */
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            padding: 0 1rem;
            margin: 1rem 0 1.5rem;
            background-color: #f6f8fa;
            border-radius: 0 3px 3px 0;
        }

        blockquote p {
            padding: 0.8rem 0;
        }

        blockquote p:first-child {
            margin-top: 0;
        }

        blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Solution styling */
        h5:has(+p:contains("Solution")) {
            margin-bottom: 0;
        }

        h5:has(+p:contains("Solution")) + p {
            font-weight: bold;
            color: #3c8dbc;
            border-left: 3px solid #3c8dbc;
            padding-left: 0.8rem;
            margin: 0.5rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
        }

        /* List styling */
        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2.5rem;
        }

        ul li, ol li {
            margin-bottom: 0.5rem;
        }

        /* Code blocks */
        .code-box {
            background-color: #f6f8fa;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0 1.5rem;
            border: 1px solid #e1e4e8;
        }

        .code-header {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.3rem 0 0rem 0.3rem;
            border-bottom: 1px solid #e1e4e8;
            background-color: #fafbfc;
        }

        .code-header a {
            color: #6a737d;
            text-decoration: none;
        }

        .code-header a:hover {
            text-decoration: underline;
            color: #0366d6;
        }

        /* Standalone code blocks (triple backticks) */
        .codehilite {
            background-color: #f6f8fa;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0 1.5rem;
            border: 1px solid #e1e4e8;
        }

        /* When inside a code-box, remove default styling */
        .code-box .codehilite {
            margin: 0;
            padding: 0;
            border: none;
            border-radius: 0;
        }

        /* Adjust padding for code blocks inside code-box */
        .code-box .codehilite pre {
            padding: 0.2rem 0 0.3rem 0.3rem;
            overflow-x: auto;
            margin: 0;
        }

        /* Normal padding for standalone code blocks */
        .codehilite pre {
            padding: 1rem;
            overflow-x: auto;
            margin: 0;
        }

        .code-output {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.2rem 0 0.3rem 0.3rem;
            border-top: 1px solid #e1e4e8;
            background-color: #fafbfc;
        }
        .code-output span {
            color: #de37cc;
        }

        .code-output pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        }
        /* --- Styles for Collapsible Code Blocks --- */
        .collapsible-code {
            border: none; /* Remove default border from details */
            margin-top: 0; /* Adjust spacing if needed */
            margin-bottom: 0; /* Adjust spacing if needed */
        }

        .code-summary {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.5rem 0.8rem; /* Adjusted padding */
            border-bottom: 1px solid #e1e4e8;
            background-color: #fafbfc;
            cursor: pointer;
            list-style: none; /* Hide default marker */
            display: block; /* Make it block level */
            border-radius: 6px 6px 0 0; /* Round top corners like header */
            position: relative; /* For positioning the marker */
            transition: background-color 0.1s ease-in-out;
        }

        .code-summary:hover {
            background-color: #f1f3f5; /* Slight hover effect */
        }

        /* Add custom marker */
        .code-summary::before {
            content: '►'; /* Collapsed marker */
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.6em;
            color: #6a737d;
            margin-right: 0.5rem;
            transition: transform 0.2s ease-in-out;
        }

        .collapsible-code[open] > .code-summary::before {
            transform: translateY(-50%) rotate(90deg); /* Expanded marker */
        }

        .collapsible-code[open] > .code-summary {
             border-bottom: 1px solid #e1e4e8; /* Ensure border shows when open */
             border-radius: 6px 6px 0 0; /* Keep top rounding when open */
        }

        /* Adjust summary content positioning relative to marker */
        .code-summary a {
            margin-left: 1.2rem; /* Space for the marker */
            color: #6a737d;
            text-decoration: none;
        }
        .code-summary a:hover {
            text-decoration: underline;
            color: #0366d6;
        }

        /* New style for the expand hint */
        .expand-hint {
            font-style: italic;
            font-size: 0.85em;
            color: #888;
            margin-left: 0.5rem;
        }

        /* Ensure content inside details has appropriate spacing/styling */
        .collapsible-code > .codehilite {
            margin: 0;
            border-radius: 0 0 6px 6px; /* Round bottom corners */
            border: none; /* Remove border from codehilite itself */
            border-top: none; /* Remove top border */
        }

        /* Since code output is now outside the details element,
           we need to adjust its styling */
        .collapsible-code + .code-output {
            border-radius: 0 0 6px 6px; /* Round bottom corners */
            margin-top: 0; /* Remove gap */
            border-top: 1px solid #e1e4e8;
        }

        /* Ensure code output has proper border when outside details */
        .code-box > .code-output {
            border-top: 1px solid #e1e4e8;
        }

        .collapsible-code > .run-racket {
             margin-left: 1rem; /* Indent run button */
             margin-bottom: 1rem; /* Add bottom margin */
        }
        /* --- End Collapsible Styles --- */

        code {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            padding: 0.2em 0.4em;
            background-color: #f6f8fa;
            border-radius: 3px;
        }

        .codehilite code {
            padding: 0;
            background-color: transparent;
        }

        /* Links */
        a {
            color: #0366d6;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Run button */
        .run-racket {
            display: inline-block;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.4rem 0.8rem;
            background-color: #3c8dbc;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .run-racket:hover {
            background-color: #367fa9;
            text-decoration: none;
        }

        /* Make LaTeX display nicely */
        .MathJax {
            overflow-x: auto;
            overflow-y: hidden;
        }
    
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
    <span class="activenav"><a href="notes-ch4-2.html">← Previous</a></span>
    <span class="activenav"><a href="../index.html">↑ Up</a></span>
    <span class="activenav"><a href="notes-ch4-4.html">Next →</a></span>
</div>

<p><a href="https://sarabander.github.io/sicp/html/4_002e3.xhtml#g_t4_002e3">HTML Book Chapter 4.3 Link</a></p>
<p><div class="table-of-contents">
<h2>Directory</h2>
<ul class="toc-list">
<ul>
<li><a href="#section-43">Section 4.3</a></li>
<ul>
<li><a href="#notes">Notes</a></li>
<li><a href="#exercises" class="toc-exercises">Exercises</a>
<div class="exercise-container">(
<span class="exercise-list">
<span><a href="#exercise-435">Exercise 4.35</a></span>
<span><a href="#exercise-436">Exercise 4.36</a></span>
<span><a href="#exercise-437">Exercise 4.37</a></span>
<span><a href="#exercise-438">Exercise 4.38</a></span>
<span><a href="#exercise-439">Exercise 4.39</a></span>
<span><a href="#exercise-440">Exercise 4.40</a></span>
<span><a href="#exercise-441">Exercise 4.41</a></span>
<span><a href="#exercise-442">Exercise 4.42</a></span>
<span><a href="#exercise-443">Exercise 4.43</a></span>
<span><a href="#exercise-444">Exercise 4.44</a></span>
<span><a href="#exercise-445">Exercise 4.45</a></span>
<span><a href="#exercise-446">Exercise 4.46</a></span>
<span><a href="#exercise-447">Exercise 4.47</a></span>
<span><a href="#exercise-448">Exercise 4.48</a></span>
<span><a href="#exercise-449">Exercise 4.49</a></span>
<span><a href="#exercise-450">Exercise 4.50</a></span>
<span><a href="#exercise-451">Exercise 4.51</a></span>
<span><a href="#exercise-452">Exercise 4.52</a></span>
<span><a href="#exercise-453">Exercise 4.53</a></span>
<span><a href="#exercise-454">Exercise 4.54</a></span>
</span>)
</div></li>
</ul>
</ul>
</ul>
</div></p>
<h2 id="section-43">Section 4.3</h2>
<h3 id="notes">Notes</h3>
<h3 id="exercises">Exercises</h3>
<h4 id="exercise-435">Exercise 4.35</h4>
<p>Write a procedure
<code>an-integer-between</code> that returns an integer between two given bounds.
This can be used to implement a procedure that finds Pythagorean triples, i.e.,
triples of integers ${(i, j, k)$} between the given bounds such that
${i \le j$} and ${i^2 + j^2 = k^2$}, as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">a-pythagorean-triple-between</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="p">(</span><span class="n">an-integer-between</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">j</span><span class="w"> </span><span class="p">(</span><span class="n">an-integer-between</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">high</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">k</span><span class="w"> </span><span class="p">(</span><span class="n">an-integer-between</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">high</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">k</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">k</span><span class="p">)))))</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-436">Exercise 4.36</h4>
<p>Exercise 3.69 discussed how
to generate the stream of <em>all</em> Pythagorean triples, with no upper bound
on the size of the integers to be searched.  Explain why simply replacing
<code>an-integer-between</code> by <code>an-integer-starting-from</code> in the procedure
in Exercise 4.35 is not an adequate way to generate arbit@-rary Py@-tha@-go@-rean
triples.  Write a procedure that actually will accomplish this.  (That is,
write a procedure for which repeatedly typing <code>try-again</code> would in
principle eventually generate all Py@-tha@-go@-rean triples.)</p>
<h5>Solution</h5>
<h4 id="exercise-437">Exercise 4.37</h4>
<p>Ben Bitdiddle claims that the
following method for generating Pythagorean triples is more efficient than the
one in Exercise 4.35.  Is he correct?  (Hint: Consider the number of
possibilities that must be explored.)</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">a-pythagorean-triple-between</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="w"> </span><span class="p">(</span><span class="n">an-integer-between</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="n">hsq</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="n">high</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">j</span><span class="w"> </span><span class="p">(</span><span class="n">an-integer-between</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">high</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">ksq</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">j</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;=</span><span class="w"> </span><span class="n">hsq</span><span class="w"> </span><span class="n">ksq</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">k</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="n">ksq</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">integer?</span><span class="w"> </span><span class="n">k</span><span class="p">))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="n">k</span><span class="p">))))))</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-438">Exercise 4.38</h4>
<p>Modify the multiple-dwelling
procedure to omit the requirement that Smith and Fletcher do not live on
adjacent floors.  How many solutions are there to this modified puzzle?</p>
<h5>Solution</h5>
<h4 id="exercise-439">Exercise 4.39</h4>
<p>Does the order of the
restrictions in the multiple-dwelling procedure affect the answer? Does it
affect the time to find an answer?  If you think it matters, demonstrate a
faster program obtained from the given one by reordering the restrictions.  If
you think it does not matter, argue your case.</p>
<h5>Solution</h5>
<h4 id="exercise-440">Exercise 4.40</h4>
<p>In the multiple dwelling problem,
how many sets of assignments are there of people to floors, both before and
after the requirement that floor assignments be distinct?  It is very
inefficient to generate all possible assignments of people to floors and then
leave it to backtracking to eliminate them.  For example, most of the
restrictions depend on only one or two of the person-floor variables, and can
thus be imposed before floors have been selected for all the people.  Write and
demonstrate a much more efficient nondeterministic procedure that solves this
problem based upon generating only those possibilities that are not already
ruled out by previous restrictions.  (Hint: This will require a nest of
<code>let</code> expressions.)</p>
<h5>Solution</h5>
<h4 id="exercise-441">Exercise 4.41</h4>
<p>Write an ordinary Scheme program
to solve the multiple dwelling puzzle.</p>
<h5>Solution</h5>
<h4 id="exercise-442">Exercise 4.42</h4>
<p>Solve the following ``Liars''
puzzle (from Phillips 1934):</p>
<p>Five schoolgirls sat for an examination.  Their parents---so they
thought---showed an undue degree of interest in the result.  They therefore
agreed that, in writing home about the examination, each girl should make one
true statement and one untrue one.  The following are the relevant passages
from their letters:</p>
<p>@itemize @bullet</p>
<p>@item
Betty: ``Kitty was second in the examination.  I was only third.''</p>
<p>@item
Ethel: ``You'll be glad to hear that I was on top.  Joan was second.''</p>
<p>@item
Joan: ``I was third, and poor old Ethel was bottom.''</p>
<p>@item
Kitty: ``I came out second.  Mary was only fourth.''</p>
<p>@item
Mary: ``I was fourth.  Top place was taken by Betty.''</p>
<p>What in fact was the order in which the five girls were placed?</p>
<h5>Solution</h5>
<h4 id="exercise-443">Exercise 4.43</h4>
<p>Use the <code>amb</code> evaluator to
solve the following puzzle:</p>
<p>@quotation
Mary Ann Moore's father has a yacht and so has each of his four friends:
Colonel Downing, Mr. Hall, Sir Barnacle Hood, and Dr.  Parker.  Each of the
five also has one daughter and each has named his yacht after a daughter of one
of the others.  Sir Barnacle's yacht is the Gabrielle, Mr. Moore owns the
Lorna; Mr. Hall the Rosalind.  The Melissa, owned by Colonel Downing, is named
after Sir Barnacle's daughter.  Gabrielle's father owns the yacht that is named
after Dr.  Parker's daughter.  Who is Lorna's father?</p>
<h5>Solution</h5>
<h4 id="exercise-444">Exercise 4.44</h4>
<p>Exercise 2.42 described the
``eight-queens puzzle'' of placing queens on a chessboard so that no two attack
each other.  Write a nondeterministic program to solve this puzzle.</p>
<h5>Solution</h5>
<h4 id="exercise-445">Exercise 4.45</h4>
<p>With the grammar given above, the
following sentence can be parsed in five different ways: ``The professor
lectures to the student in the class with the cat.''  Give the five parses and
explain the differences in shades of meaning among them.</p>
<h5>Solution</h5>
<h4 id="exercise-446">Exercise 4.46</h4>
<p>The evaluators in 
4.1 and 4.2 do not determine what order operands are evaluated in.
We will see that the <code>amb</code> evaluator evaluates them from left to right.
Explain why our parsing program wouldn't work if the operands were evaluated in
some other order.</p>
<h5>Solution</h5>
<h4 id="exercise-447">Exercise 4.47</h4>
<p>Louis Reasoner suggests that,
since a verb phrase is either a verb or a verb phrase followed by a
prepositional phrase, it would be much more straightforward to define the
procedure <code>parse-verb-phrase</code> as follows (and similarly for noun phrases):</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">parse-verb-phrase</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">amb</span><span class="w"> </span><span class="p">(</span><span class="n">parse-word</span><span class="w"> </span><span class="n">verbs</span><span class="p">)</span>
<span class="w">       </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span>
<span class="w">        </span><span class="o">&#39;</span><span class="ss">verb-phrase</span>
<span class="w">        </span><span class="p">(</span><span class="n">parse-verb-phrase</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="n">parse-prepositional-phrase</span><span class="p">))))</span>
</code></pre></div>

<p>Does this work?  Does the program's behavior change if we interchange the order
of expressions in the <code>amb</code>?</p>
<h5>Solution</h5>
<h4 id="exercise-448">Exercise 4.48</h4>
<p>Extend the grammar given above to
handle more complex sentences.  For example, you could extend noun phrases and
verb phrases to include adjectives and adverbs, or you could handle compound
sentences.</p>
<h5>Solution</h5>
<h4 id="exercise-449">Exercise 4.49</h4>
<p>Alyssa P. Hacker is more
interested in generating interesting sentences than in parsing them.  She
reasons that by simply changing the procedure <code>parse-word</code> so that it
ignores the ``input sentence'' and instead always succeeds and generates an
appropriate word, we can use the programs we had built for parsing to do
generation instead.  Implement Alyssa's idea, and show the first half-dozen or
so sentences generated.</p>
<h5>Solution</h5>
<h4 id="exercise-450">Exercise 4.50</h4>
<p>Implement a new special form
<code>ramb</code> that is like <code>amb</code> except that it searches alternatives in a
random order, rather than from left to right.  Show how this can help with
Alyssa's problem in Exercise 4.49.</p>
<h5>Solution</h5>
<h4 id="exercise-451">Exercise 4.51</h4>
<p>Implement a new kind of
assignment called <code>permanent-set!</code> that is not undone upon failure.  For
example, we can choose two distinct elements from a list and count the number
of trials required to make a successful choice as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">an-element-of</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="ss">a</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="ss">c</span><span class="p">)))</span>
<span class="w">      </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="p">(</span><span class="n">an-element-of</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="ss">a</span><span class="w"> </span><span class="ss">b</span><span class="w"> </span><span class="ss">c</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="n">permanent-set!</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="nb">eq?</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="p">)))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="nb">count</span><span class="p">))</span>

<span class="c1">;;; Starting a new problem</span>
<span class="c1">;;; Amb-Eval value:</span>
<span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>

<span class="c1">;;; Amb-Eval input:</span>
<span class="n">try-again</span>

<span class="c1">;;; Amb-Eval value:</span>
<span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>

<p>What values would have been displayed if we had used <code>set!</code> here
rather than <code>permanent-set!</code>?</p>
<h5>Solution</h5>
<h4 id="exercise-452">Exercise 4.52</h4>
<p>Implement a new construct called
<code>if-fail</code> that permits the user to catch the failure of an expression.
<code>If-fail</code> takes two expressions.  It evaluates the first expression as
usual and returns as usual if the evaluation succeeds.  If the evaluation
fails, however, the value of the second expression is returned, as in the
following example:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">;;; Amb-Eval input:</span>
<span class="p">(</span><span class="n">if-fail</span><span class="w"> </span>
<span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">an-element-of</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="p">))))</span>
<span class="w">   </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">even?</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">   </span><span class="n">x</span><span class="p">)</span>
<span class="w"> </span><span class="o">&#39;</span><span class="ss">all-odd</span><span class="p">)</span>

<span class="c1">;;; Starting a new problem</span>
<span class="c1">;;; Amb-Eval value:</span>
<span class="n">all-odd</span>

<span class="c1">;;; Amb-Eval input:</span>
<span class="p">(</span><span class="n">if-fail</span>
<span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">an-element-of</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">8</span><span class="p">))))</span>
<span class="w">   </span><span class="p">(</span><span class="k">require</span><span class="w"> </span><span class="p">(</span><span class="nb">even?</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">   </span><span class="n">x</span><span class="p">)</span>
<span class="w"> </span><span class="o">&#39;</span><span class="ss">all-odd</span><span class="p">)</span>

<span class="c1">;;; Starting a new problem</span>
<span class="c1">;;; Amb-Eval value:</span>
<span class="mi">8</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-453">Exercise 4.53</h4>
<p>With <code>permanent-set!</code> as
described in Exercise 4.51 and <code>if-fail</code> as in Exercise 4.52,
what will be the result of evaluating</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">pairs</span><span class="w"> </span><span class="o">&#39;</span><span class="p">()))</span>
<span class="w">  </span><span class="p">(</span><span class="n">if-fail</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">prime-sum-pair</span><span class="w"> </span>
<span class="w">             </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">20</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="mi">110</span><span class="p">))))</span>
<span class="w">     </span><span class="p">(</span><span class="n">permanent-set!</span><span class="w"> </span><span class="n">pairs</span><span class="w"> </span>
<span class="w">                     </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">pairs</span><span class="p">))</span>
<span class="w">     </span><span class="p">(</span><span class="n">amb</span><span class="p">))</span>
<span class="w">   </span><span class="n">pairs</span><span class="p">))</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-454">Exercise 4.54</h4>
<p>If we had not realized that
<code>require</code> could be implemented as an ordinary procedure that uses
<code>amb</code>, to be defined by the user as part of a nondeterministic program, we
would have had to implement it as a special form.  This would require syntax
procedures</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">require?</span><span class="w"> </span><span class="nb">exp</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">tagged-list?</span><span class="w"> </span><span class="nb">exp</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">require</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">require-predicate</span><span class="w"> </span><span class="nb">exp</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">cadr</span><span class="w"> </span><span class="nb">exp</span><span class="p">))</span>
</code></pre></div>

<p>and a new clause in the dispatch in <code>analyze</code></p>
<div class="codehilite"><pre><span></span><code><span class="p">((</span><span class="n">require?</span><span class="w"> </span><span class="nb">exp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">analyze-require</span><span class="w"> </span><span class="nb">exp</span><span class="p">))</span>
</code></pre></div>

<p>as well the procedure <code>analyze-require</code> that handles <code>require</code>
expressions.  Complete the following definition of <code>analyze-require</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">analyze-require</span><span class="w"> </span><span class="nb">exp</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">pproc</span><span class="w"> </span><span class="p">(</span><span class="n">analyze</span><span class="w"> </span>
<span class="w">                </span><span class="p">(</span><span class="n">require-predicate</span><span class="w"> </span><span class="nb">exp</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">env</span><span class="w"> </span><span class="n">succeed</span><span class="w"> </span><span class="n">fail</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">pproc</span><span class="w"> </span><span class="n">env</span>
<span class="w">             </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">pred-value</span><span class="w"> </span><span class="n">fail2</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="n">⟨??⟩</span>
<span class="w">                   </span><span class="n">⟨??⟩</span>
<span class="w">                   </span><span class="p">(</span><span class="n">succeed</span><span class="w"> </span><span class="o">&#39;</span><span class="ss">ok</span><span class="w"> </span><span class="n">fail2</span><span class="p">)))</span>
<span class="w">             </span><span class="n">fail</span><span class="p">))))</span>
</code></pre></div>

<h5>Solution</h5>
    </div>
</body>
</html>
