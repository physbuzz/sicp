<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>notes-ch3-5.md</title>
    <!-- MathJax for LaTeX support -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            }
        };
    </script>
    <style>
        /* Pygments Syntax Highlighting */
        pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #3D7B7B; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #9C6500 } /* Comment.Preproc */
.codehilite .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.codehilite .gr { color: #E40000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #008400 } /* Generic.Inserted */
.codehilite .go { color: #717171 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #687822 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #717171; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #767600 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #A45A77 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */

        /* Base CSS from markdown_styles.py */
        
        /* Basic reset and fonts */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            padding: 0;
            background-color: #f8f9fa;
        }

        /* Navigation styling */
        .nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid #e1e4e8;
        }

        .nav span {
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav .activenav {
            background-color: #f1f8ff;
        }

        .nav .activenav a {
            color: #0366d6;
            text-decoration: none;
        }

        .nav .activenav a:hover {
            text-decoration: underline;
        }

        .nav .inactivenav {
            color: #959da5;
            background-color: #f6f8fa;
        }

        /* Center column layout */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: white;
            padding: 2rem 3rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Typography */
        h1 {
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
        }

        h2 {
            font-size: 1.8rem;
            margin: 2rem 0 1rem;
            color: #34495e;
        }

        h3 {
            font-size: 1.5rem;
            margin: 1.8rem 0 1rem;
            color: #34495e;
        }

        h4 {
            font-size: 1.3rem;
            margin: 1.5rem 0 0.8rem;
            color: #34495e;
        }

        h5 {
            font-size: 1.1rem;
            margin: 1.2rem 0 0.8rem;
            color: #34495e;
        }

        /* Table of Contents styling */
        .table-of-contents {
            margin: 0 0 0;
            line-height: 1;
        }

        .toc-list {
            margin: 0;
            padding-left: 20px;
        }

        .toc-list li {
            margin-bottom: 2px;
        }
        .toc-list ul {
            margin-bottom: 2px;
        }

        .exercise-list {
            margin: 0;
            padding-left: 0;
            font-size: 0.95em;
            display: inline;
        }

        .exercise-container {
            display: inline-block;
            margin-top: 2px;
            line-height: 1.2;
        }

        .toc-exercises {
            font-style: italic;
            color: #555;
        }

        .exercise-list a {
            text-decoration: none;
            color: #2070b0;
            margin-right: 0;
        }

        .exercise-list a:hover {
            text-decoration: underline;
        }

        .exercise-list span:not(:last-child):after {
            content: ", ";
            color: #777;
            margin-right: 0;
        }

        /* Blockquote styling */
        blockquote {
            border-left: 4px solid #dfe2e5;
            color: #6a737d;
            padding: 0 1rem;
            margin: 1rem 0 1.5rem;
            background-color: #f6f8fa;
            border-radius: 0 3px 3px 0;
        }

        blockquote p {
            padding: 0.8rem 0;
        }

        blockquote p:first-child {
            margin-top: 0;
        }

        blockquote p:last-child {
            margin-bottom: 0;
        }

        /* Solution styling */
        h5:has(+p:contains("Solution")) {
            margin-bottom: 0;
        }

        h5:has(+p:contains("Solution")) + p {
            font-weight: bold;
            color: #3c8dbc;
            border-left: 3px solid #3c8dbc;
            padding-left: 0.8rem;
            margin: 0.5rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
        }

        /* List styling */
        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2.5rem;
        }

        ul li, ol li {
            margin-bottom: 0.5rem;
        }

        /* Code blocks */
        .code-box {
            background-color: #f6f8fa;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0 1.5rem;
            border: 1px solid #e1e4e8;
        }

        .code-header {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.3rem 0 0rem 0.3rem;
            border-bottom: 1px solid #e1e4e8;
            background-color: #fafbfc;
        }

        .code-header a {
            color: #6a737d;
            text-decoration: none;
        }

        .code-header a:hover {
            text-decoration: underline;
            color: #0366d6;
        }

        /* Standalone code blocks (triple backticks) */
        .codehilite {
            background-color: #f6f8fa;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0 1.5rem;
            border: 1px solid #e1e4e8;
        }

        /* When inside a code-box, remove default styling */
        .code-box .codehilite {
            margin: 0;
            padding: 0;
            border: none;
            border-radius: 0;
        }

        /* Adjust padding for code blocks inside code-box */
        .code-box .codehilite pre {
            padding: 0.2rem 0 0.3rem 0.3rem;
            overflow-x: auto;
            margin: 0;
        }

        /* Normal padding for standalone code blocks */
        .codehilite pre {
            padding: 1rem;
            overflow-x: auto;
            margin: 0;
        }

        .code-output {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.2rem 0 0.3rem 0.3rem;
            border-top: 1px solid #e1e4e8;
            background-color: #fafbfc;
        }
        .code-output span {
            color: #de37cc;
        }

        .code-output pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        }
        /* --- Styles for Collapsible Code Blocks --- */
        .collapsible-code {
            border: none; /* Remove default border from details */
            margin-top: 0; /* Adjust spacing if needed */
            margin-bottom: 0; /* Adjust spacing if needed */
        }

        .code-summary {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.75rem;
            color: #6a737d;
            padding: 0.5rem 0.8rem; /* Adjusted padding */
            border-bottom: 1px solid #e1e4e8;
            background-color: #fafbfc;
            cursor: pointer;
            list-style: none; /* Hide default marker */
            display: block; /* Make it block level */
            border-radius: 6px 6px 0 0; /* Round top corners like header */
            position: relative; /* For positioning the marker */
            transition: background-color 0.1s ease-in-out;
        }

        .code-summary:hover {
            background-color: #f1f3f5; /* Slight hover effect */
        }

        /* Add custom marker */
        .code-summary::before {
            content: '►'; /* Collapsed marker */
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.6em;
            color: #6a737d;
            margin-right: 0.5rem;
            transition: transform 0.2s ease-in-out;
        }

        .collapsible-code[open] > .code-summary::before {
            transform: translateY(-50%) rotate(90deg); /* Expanded marker */
        }

        .collapsible-code[open] > .code-summary {
             border-bottom: 1px solid #e1e4e8; /* Ensure border shows when open */
             border-radius: 6px 6px 0 0; /* Keep top rounding when open */
        }

        /* Adjust summary content positioning relative to marker */
        .code-summary a {
            margin-left: 1.2rem; /* Space for the marker */
            color: #6a737d;
            text-decoration: none;
        }
        .code-summary a:hover {
            text-decoration: underline;
            color: #0366d6;
        }

        /* New style for the expand hint */
        .expand-hint {
            font-style: italic;
            font-size: 0.85em;
            color: #888;
            margin-left: 0.5rem;
        }

        /* Ensure content inside details has appropriate spacing/styling */
        .collapsible-code > .codehilite {
            margin: 0;
            border-radius: 0 0 6px 6px; /* Round bottom corners */
            border: none; /* Remove border from codehilite itself */
            border-top: none; /* Remove top border */
        }

        /* Since code output is now outside the details element,
           we need to adjust its styling */
        .collapsible-code + .code-output {
            border-radius: 0 0 6px 6px; /* Round bottom corners */
            margin-top: 0; /* Remove gap */
            border-top: 1px solid #e1e4e8;
        }

        /* Ensure code output has proper border when outside details */
        .code-box > .code-output {
            border-top: 1px solid #e1e4e8;
        }

        .collapsible-code > .run-racket {
             margin-left: 1rem; /* Indent run button */
             margin-bottom: 1rem; /* Add bottom margin */
        }
        /* --- End Collapsible Styles --- */

        code {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            padding: 0.2em 0.4em;
            background-color: #f6f8fa;
            border-radius: 3px;
        }

        .codehilite code {
            padding: 0;
            background-color: transparent;
        }

        /* Links */
        a {
            color: #0366d6;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Run button */
        .run-racket {
            display: inline-block;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.4rem 0.8rem;
            background-color: #3c8dbc;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .run-racket:hover {
            background-color: #367fa9;
            text-decoration: none;
        }

        /* Make LaTeX display nicely */
        .MathJax {
            overflow-x: auto;
            overflow-y: hidden;
        }
    
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
    <span class="activenav"><a href="notes-ch3-4.html">← Previous</a></span>
    <span class="activenav"><a href="../index.html">↑ Up</a></span>
    <span class="activenav"><a href="../ch4/notes-ch4-1.html">Next →</a></span>
</div>

<p><a href="https://sarabander.github.io/sicp/html/3_002e5.xhtml#g_t3_002e5">HTML Book Chapter 3.5 Link</a></p>
<p><div class="table-of-contents">
<h2>Directory</h2>
<ul class="toc-list">
<ul>
<li><a href="#section-35">Section 3.5</a></li>
<ul>
<li><a href="#examples-and-notes">Examples and Notes</a></li>
<li><a href="#exercises" class="toc-exercises">Exercises</a>
<div class="exercise-container">(
<span class="exercise-list">
<span><a href="#exercise-350">Exercise 3.50</a></span>
<span><a href="#exercise-351">Exercise 3.51</a></span>
<span><a href="#exercise-352">Exercise 3.52</a></span>
<span><a href="#exercise-353">Exercise 3.53</a></span>
<span><a href="#exercise-354">Exercise 3.54</a></span>
<span><a href="#exercise-355">Exercise 3.55</a></span>
<span><a href="#exercise-356">Exercise 3.56</a></span>
<span><a href="#exercise-357">Exercise 3.57</a></span>
<span><a href="#exercise-358">Exercise 3.58</a></span>
<span><a href="#exercise-359">Exercise 3.59</a></span>
<span><a href="#exercise-360">Exercise 3.60</a></span>
<span><a href="#exercise-361">Exercise 3.61</a></span>
<span><a href="#exercise-362">Exercise 3.62</a></span>
<span><a href="#exercise-363">Exercise 3.63</a></span>
<span><a href="#exercise-364">Exercise 3.64</a></span>
<span><a href="#exercise-365">Exercise 3.65</a></span>
<span><a href="#exercise-366">Exercise 3.66</a></span>
<span><a href="#exercise-367">Exercise 3.67</a></span>
<span><a href="#exercise-368">Exercise 3.68</a></span>
<span><a href="#exercise-369">Exercise 3.69</a></span>
<span><a href="#exercise-370">Exercise 3.70</a></span>
<span><a href="#exercise-371">Exercise 3.71</a></span>
<span><a href="#exercise-372">Exercise 3.72</a></span>
<span><a href="#exercise-373">Exercise 3.73</a></span>
<span><a href="#exercise-374">Exercise 3.74</a></span>
<span><a href="#exercise-375">Exercise 3.75</a></span>
<span><a href="#exercise-376">Exercise 3.76</a></span>
<span><a href="#exercise-377">Exercise 3.77</a></span>
<span><a href="#exercise-378">Exercise 3.78</a></span>
<span><a href="#exercise-379">Exercise 3.79</a></span>
<span><a href="#exercise-380">Exercise 3.80</a></span>
<span><a href="#exercise-381">Exercise 3.81</a></span>
<span><a href="#exercise-382">Exercise 3.82</a></span>
</span>)
</div></li>
</ul>
</ul>
</ul>
</div></p>
<h2 id="section-35">Section 3.5</h2>
<h3 id="examples-and-notes">Examples and Notes</h3>
<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/example-3-5-1.rkt">code/example-3-5-1.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="c1">;; Library functions</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">accumulate</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null?</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
<span class="w">      </span><span class="n">initial</span>
<span class="w">      </span><span class="p">(</span><span class="n">op</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="n">accumulate</span><span class="w"> </span><span class="n">op</span>
<span class="w">                      </span><span class="n">initial</span>
<span class="w">                      </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="n">sequence</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">predicate</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">null?</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span><span class="w"> </span><span class="n">nil</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">predicate</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">sequence</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
<span class="w">               </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">predicate</span>
<span class="w">                       </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="n">sequence</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w">  </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">predicate</span>
<span class="w">                       </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="n">sequence</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">smallest-divisor</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">find-divisor</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">square</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">n</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">find-divisor</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">test-divisor</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">square</span><span class="w"> </span><span class="n">test-divisor</span><span class="p">)</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">         </span><span class="n">n</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">divides?</span><span class="w"> </span><span class="n">test-divisor</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">         </span><span class="n">test-divisor</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="n">find-divisor</span>
<span class="w">               </span><span class="n">n</span>
<span class="w">               </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">test-divisor</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">divides?</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">prime?</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="n">smallest-divisor</span><span class="w"> </span><span class="n">n</span><span class="p">)))</span>



<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">nil</span>
<span class="w">      </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">low</span><span class="w"> </span>
<span class="w">            </span><span class="p">(</span><span class="n">enumerate-interval</span><span class="w"> </span>
<span class="w">             </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="n">high</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sum-primes-1</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="n">accum</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">accum</span><span class="p">)</span>
<span class="w">          </span><span class="p">((</span><span class="n">prime?</span><span class="w"> </span><span class="nb">count</span><span class="p">)</span>
<span class="w">           </span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="n">accum</span><span class="p">)))</span>
<span class="w">          </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nb">count</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">accum</span><span class="p">))))</span>
<span class="w">  </span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sum-primes-2</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">accumulate</span>
<span class="w">   </span><span class="nb">+</span>
<span class="w">   </span><span class="mi">0</span>
<span class="w">   </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="n">prime?</span><span class="w"> </span><span class="p">(</span><span class="n">enumerate-interval</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">))))</span>


<span class="p">(</span><span class="n">sum-primes-1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<span class="p">(</span><span class="n">sum-primes-2</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>76128
76128
</pre>
</div>
</div>

<div class="code-box">
<div class="code-header"><a href="code/example-3-5-2.rkt">code/example-3-5-2.rkt</a></div>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="k">delay</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">str</span><span class="p">)</span>

<span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="n">str</span><span class="p">))</span>

<span class="c1">;; This gives an error:</span>
<span class="c1">;; ((cdr str))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>
<span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>


<div class="code-output">
<span>Output:</span>
<pre>1
2
1
2
</pre>
</div>
</div>

<div class="code-box">
<div class="code-header"><a href="code/example-3-5-3.rkt">code/example-3-5-3.rkt</a></div>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>

<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">6</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>


<span class="c1">;; (stream-car </span>
<span class="c1">;;  (stream-cdr</span>
<span class="c1">;;   (stream-filter </span>
<span class="c1">;;    prime? (stream-enumerate-interval </span>
<span class="c1">;;            10000 1000000))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">         </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">pred</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">           </span><span class="n">pred</span>
<span class="w">           </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">               </span><span class="n">pred</span>
<span class="w">               </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))))</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">⟨??⟩</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">⟨??⟩</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span>
<span class="w">              </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                    </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">⟨??⟩</span>
<span class="w">                         </span><span class="n">argstreams</span><span class="p">))))))</span>
</code></pre></div>


<div class="code-output">
<span>Output:</span>
<pre>
Error (exit code 1):
src/ch3/code/example-3-5-3.rkt:85:9: module: identifier already defined
  at: stream-map
  in: (define-values (stream-map) (r5rs:lambda (proc . argstreams) (if (⟨??⟩ (car argstreams)) the-empty-stream (⟨??⟩ (apply proc (map ⟨??⟩ argstreams)) (apply stream-map (cons proc (map ⟨??⟩ argstreams)))))))
  location...:
   src/ch3/code/example-3-5-3.rkt:85:9
</pre>
</div>
</div>

<p>Note to self: I had a half-thought-out concern about the caching. In the solution
to 3.55:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">))))</span>
</code></pre></div>

<p>I'd be concerned that if <code>(partial-sums s)</code> created a new stream with new 
cached values at every step, that we wouldn't get the additive behavior we want?
Does this make any sense? Can I replicate and understand this with just lambdas?</p>
<h3 id="exercises">Exercises</h3>
<h4 id="exercise-350">Exercise 3.50</h4>
<p>Complete the following
definition, which generalizes <code>stream-map</code> to allow procedures that take
multiple arguments, analogous to <code>map</code> in 2.2.1, 
Footnote 78.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">⟨??⟩</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">⟨??⟩</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span>
<span class="w">              </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span>
<span class="w">                         </span><span class="n">argstreams</span><span class="p">))))))</span>
</code></pre></div>

<h5>Solution</h5>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="c1">;; Enumerate every other triangular number</span>
<span class="c1">;; ie every other entry from the sequence  </span>
<span class="c1">;; 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ... n*(n+1)/2</span>
<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="nb">*</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="m">1/2</span><span class="w"> </span><span class="mi">5</span><span class="p">)))</span>
</code></pre></div>

<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-50.rkt">code/ex3-50.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">the-empty-stream</span>
<span class="w">    </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">     </span><span class="n">c</span>
<span class="w">     </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="c1">; (display-stream (stream-enumerate-evens 1 6))</span>
<span class="c1">; (display-stream (stream-enumerate-odds 1 6))</span>
<span class="c1">; (display-stream (stream-enumerate-constant 1/2 6))</span>

<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="nb">*</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="m">1/2</span><span class="w"> </span><span class="mi">5</span><span class="p">)))</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>
1
6
15
28
45done
</pre>
</div>
</div>

<p><strong><em>Note</em></strong> I wrote a really really bad definition of stream-map on a first pass!!!
The following definition has major issues because <code>rest</code> is evaluated immediately. 
In fact it <em>has</em> to be inside cons-stream (where the second argument is delayed)
to avoid infinite recursion in scenarios like in problem 3.53.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">;; bad awful definition of stream-map</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">args</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">            </span><span class="p">(</span><span class="nb">rest</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)))</span>
<span class="w">        </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">         </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="nb">rest</span><span class="p">))))))</span>
</code></pre></div>

<h4 id="exercise-351">Exercise 3.51</h4>
<p>In order to take a closer look at
delayed evaluation, we will use the following procedure, which simply returns
its argument after printing it:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">show</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="p">)</span>
</code></pre></div>

<p>What does the interpreter print in response to evaluating each expression in
the following sequence?</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">x</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="n">show</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">10</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
</code></pre></div>

<h5>Solution</h5>
<p>Zero is printed right when we define x, 
because with our definitions the first element of the 
stream is computed right away.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">show</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">x</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span>
<span class="w">   </span><span class="n">show</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">10</span><span class="p">)))</span>
<span class="c1">; 0</span>
</code></pre></div>

<p>Next, we compute stream-ref, and we print the following,
no surprises yet:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="c1">; 1</span>
<span class="c1">; 2</span>
<span class="c1">; 3</span>
<span class="c1">; 4</span>
<span class="c1">; 5 &lt;- from (newline) (display 5)</span>
<span class="c1">; 5 &lt;- from the output of the function</span>
</code></pre></div>

<p>When we print 7, we find that only the results for elements
6 and 7 are printed, because all other entries have been 
memoized.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="c1">; 6</span>
<span class="c1">; 7 &lt;- from (newline) (display 5)</span>
<span class="c1">; 7 &lt;- from the output of the function</span>
</code></pre></div>

<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-51.rkt">code/ex3-51.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">the-empty-stream</span>
<span class="w">    </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">     </span><span class="n">c</span>
<span class="w">     </span><span class="p">(</span><span class="n">stream-enumerate-constant</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="c1">; (display-stream (stream-enumerate-evens 1 6))</span>
<span class="c1">; (display-stream (stream-enumerate-odds 1 6))</span>
<span class="c1">; (display-stream (stream-enumerate-constant 1/2 6))</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">show</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="n">x</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">x</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span>
<span class="w">   </span><span class="n">show</span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">10</span><span class="p">)))</span>
<span class="c1">; 0</span>

<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="c1">; 1</span>
<span class="c1">; 2</span>
<span class="c1">; 3</span>
<span class="c1">; 4</span>
<span class="c1">; 5 &lt;- from (newline) (display 5)</span>
<span class="c1">; 5 &lt;- from the output of the function</span>
<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="c1">; 6</span>
<span class="c1">; 7 &lt;- from (newline) (display 5)</span>
<span class="c1">; 7 &lt;- from the output of the function</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>
0
1
2
3
4
55

6
77
</pre>
</div>
</div>

<h4 id="exercise-352">Exercise 3.52</h4>
<p>Consider the sequence of
expressions</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">accum</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">sum</span><span class="p">))</span>
<span class="w">  </span><span class="n">sum</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="n">accum</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="nb">even?</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">z</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>

<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">z</span><span class="p">)</span>
</code></pre></div>

<p>What is the value of <code>sum</code> after each of the above expressions is
evaluated?  What is the printed response to evaluating the <code>stream-ref</code>
and <code>display-stream</code> expressions?  Would these responses differ if we had
implemented <code>(delay ⟨exp⟩)</code> simply as <code>(lambda () ⟨exp⟩)</code>
without using the optimization provided by <code>memo-proc</code>?  Explain.</p>
<h5>Solution</h5>
<p>The evaluations would be very different if we didn't memoize. Each time we evaluate a term
using <code>stream-cdr</code>, we modify <code>sum</code>, and so if we wanted to regenerate the earlier portions of the list,
we'd have to reset <code>sum</code> to zero every time we did an operation.</p>
<p>With memoization we get the following:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">accum</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">sum</span><span class="p">))</span>
<span class="w">  </span><span class="n">sum</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="n">accum</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>
<span class="c1">;; display stream would print:</span>
<span class="c1">;; 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, 66, 78, 91, 105, 120, 136, 153, 171, 190, 210</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="nb">even?</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>
<span class="c1">;; Evens: 6, 10, 28, 36, 66, 78, 120, 136, 190, 210</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">z</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>
<span class="c1">;; Divisible by 5: 10, 15, 45, 55, 105, 120, 190, 210</span>

<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="c1">;; 136, the seventh even triangular number</span>
<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">z</span><span class="p">)</span>
<span class="c1">;; Prints 10, 15, 45, 55, 105, 120, 190, 210</span>
</code></pre></div>

<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-52.rkt">code/ex3-52.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">         </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">pred</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">           </span><span class="n">pred</span>
<span class="w">           </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">               </span><span class="n">pred</span>
<span class="w">               </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">accum</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">set!</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">sum</span><span class="p">))</span>
<span class="w">  </span><span class="n">sum</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">seq</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span>
<span class="w">   </span><span class="n">accum</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">20</span><span class="p">)))</span>
<span class="c1">;; 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, 66, 78, 91, 105, 120, 136, 153, 171, 190, 210</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="nb">even?</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>
<span class="c1">;; Evens: 6, 10, 28, 36, 66, 78, 120, 136, 190, 210</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">z</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span>
<span class="w">   </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">seq</span><span class="p">))</span>
<span class="c1">;; Divisible by 5: 10, 15, 45, 55, 105, 120, 190, 210</span>

<span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="c1">;; 136, the seventh even triangular number</span>
<span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">z</span><span class="p">)</span>
<span class="c1">;; Prints 10, 15, 45, 55, 105, 120, 190, 210</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>136

10
15
45
55
105
120
190
210done
</pre>
</div>
</div>

<h4 id="exercise-353">Exercise 3.53</h4>
<p>Without running the program,
describe the elements of the stream defined by</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span>
</code></pre></div>

<h5>Solution</h5>
<p><code>stream-car</code> of s trivially runs fine and returns 1. </p>
<p>The interesting stuff is when we call 
<code>stream-cdr</code>. We do <code>force</code> to evaluate <code>add-streams</code>, this looks something like</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span>
</code></pre></div>

<p>We create a new stream which looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">  </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span>
</code></pre></div>

<p>We might expect this to give an infinite recursion, but in fact the second 
argument is delayed, and so doesn't evaluate. (if it evaluated, we'd be in trouble.)</p>
<p>Double checking by evaluating:</p>
<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-53.rkt">code/ex3-53.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">s</span><span class="p">)))</span>


<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>
1
2
4
8
16
32</pre>
</div>
</div>

<h4 id="exercise-354">Exercise 3.54</h4>
<p>Define a procedure
<code>mul-streams</code>, analogous to <code>add-streams</code>, that produces the
elementwise product of its two input streams.  Use this together with the
stream of <code>integers</code> to complete the following definition of the stream
whose $n^{\text{th}}$ element (counting from 0) is $n + 1$ factorial:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">factorials</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="p">)))</span>
</code></pre></div>

<h5>Solution</h5>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">*</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">factorials</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="n">factorials</span><span class="p">)))</span>
</code></pre></div>

<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-54.rkt">code/ex3-54.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="k">begin</span><span class="w"> </span>
<span class="w">      </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">         </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">pred</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">           </span><span class="n">pred</span>
<span class="w">           </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">               </span><span class="n">pred</span>
<span class="w">               </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">*</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">   </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">factorials</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="n">factorials</span><span class="p">)))</span>
<span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="n">factorials</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>
1
1
2
6
24
120
720
5040
40320
362880</pre>
</div>
</div>

<h4 id="exercise-355">Exercise 3.55</h4>
<p>Define a procedure
<code>partial-sums</code> that takes as argument a stream $S$ and returns the
stream whose elements are $S_0$, $S_0 + S_1$, $S_0 + S_1 + S_2, \dots $.<br />
For example, <code>(partial-sums integers)</code> should be the
stream 1, 3, 6, 10, 15, $\ldots$.</p>
<h5>Solution</h5>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">))))</span>
</code></pre></div>

<div class="code-box">
<details class="collapsible-code">
<summary class="code-summary"><a href="code/ex3-55.rkt">code/ex3-55.rkt</a> <span class="expand-hint">(click to expand)</span></summary>

<div class="codehilite"><pre><span></span><code><span class="kn">#lang </span><span class="nn">sicp</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="nb">force</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="n">low</span>
<span class="w">       </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                                  </span><span class="n">high</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-odds</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">stream-enumerate-evens</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">high</span><span class="p">)</span><span class="w"> </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">high</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="n">low</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-enumerate-interval</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">                                     </span><span class="n">high</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="o">&#39;</span><span class="ss">done</span>
<span class="w">      </span><span class="p">(</span><span class="k">begin</span>
<span class="w">        </span><span class="p">(</span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">        </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">proc</span>
<span class="w">                         </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-for-each</span><span class="w"> </span><span class="n">display-line</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="k">begin</span><span class="w"> </span>
<span class="w">      </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">))</span>
<span class="w">      </span><span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">display-line</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">newline</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">display</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>


<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="nb">stream-ref</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">argstreams</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">      </span><span class="n">the-empty-stream</span>
<span class="w">      </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-car</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))</span>
<span class="w">       </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="nb">map</span><span class="w"> </span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">argstreams</span><span class="p">))))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">         </span><span class="n">the-empty-stream</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">pred</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="k">stream</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">           </span><span class="n">pred</span>
<span class="w">           </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">))))</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span><span class="w"> </span><span class="p">(</span><span class="nb">stream-filter</span>
<span class="w">               </span><span class="n">pred</span>
<span class="w">               </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="k">stream</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">+</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">mul-streams</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="nb">*</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">   </span><span class="n">n</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">integers</span><span class="w"> </span><span class="p">(</span><span class="n">integers-starting-from</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">s</span><span class="p">))))</span>
<span class="p">(</span><span class="n">display-stream-first-n</span><span class="w"> </span><span class="p">(</span><span class="n">partial-sums</span><span class="w"> </span><span class="n">integers</span><span class="p">)</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>


</details>
<div class="code-output">
<span>Output:</span>
<pre>
0
1
3
6
10
15
21
28
36
45</pre>
</div>
</div>

<h4 id="exercise-356">Exercise 3.56</h4>
<p>A famous problem, first raised by
R. Hamming, is to enumerate, in ascending order with no repetitions, all
positive integers with no prime factors other than 2, 3, or 5.  One obvious way
to do this is to simply test each integer in turn to see whether it has any
factors other than 2, 3, and 5.  But this is very inefficient, since, as the
integers get larger, fewer and fewer of them fit the requirement.  As an
alternative, let us call the required stream of numbers <code>S</code> and notice the
following facts about it.</p>
<p>@itemize @bullet</p>
<p>@item
<code>S</code> begins with 1.</p>
<p>@item
The elements of <code>(scale-stream S 2)</code> are also
elements of <code>S</code>.</p>
<p>@item
The same is true for <code>(scale-stream S 3)</code>
and <code>(scale-stream S 5)</code>.</p>
<p>@item
These are all the elements of <code>S</code>.</p>
<p>Now all we have to do is combine elements from these sources.  For this we
define a procedure <code>merge</code> that combines two ordered streams into one
ordered result stream, eliminating repetitions:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">merge</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s1</span><span class="p">)</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="n">s1</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="k">else</span>
<span class="w">         </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">s1car</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s1</span><span class="p">))</span>
<span class="w">               </span><span class="p">(</span><span class="n">s2car</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s2</span><span class="p">)))</span>
<span class="w">           </span><span class="p">(</span><span class="k">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">s1car</span><span class="w"> </span><span class="n">s2car</span><span class="p">)</span>
<span class="w">                  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">                   </span><span class="n">s1car</span><span class="w"> </span>
<span class="w">                   </span><span class="p">(</span><span class="n">merge</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s1</span><span class="p">)</span><span class="w"> </span>
<span class="w">                          </span><span class="n">s2</span><span class="p">)))</span>
<span class="w">                 </span><span class="p">((</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">s1car</span><span class="w"> </span><span class="n">s2car</span><span class="p">)</span>
<span class="w">                  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">                   </span><span class="n">s2car</span><span class="w"> </span>
<span class="w">                   </span><span class="p">(</span><span class="n">merge</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span>
<span class="w">                          </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s2</span><span class="p">))))</span>
<span class="w">                 </span><span class="p">(</span><span class="k">else</span>
<span class="w">                  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">                   </span><span class="n">s1car</span>
<span class="w">                   </span><span class="p">(</span><span class="n">merge</span><span class="w"> </span>
<span class="w">                    </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s2</span><span class="p">)))))))))</span>
</code></pre></div>

<p>Then the required stream may be constructed with <code>merge</code>, as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">S</span><span class="w"> </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">merge</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="p">)))</span>
</code></pre></div>

<p>Fill in the missing expressions in the places marked <code>⟨??⟩</code> above.</p>
<h5>Solution</h5>
<h4 id="exercise-357">Exercise 3.57</h4>
<p>How many additions are performed
when we compute the $n^{\text{th}}$ Fibonacci number using the definition of
<code>fibs</code> based on the <code>add-streams</code> procedure?  Show that the number of
additions would be exponentially greater if we had implemented <code>(delay ⟨@var{exp}⟩)</code> 
simply as <code>(lambda () ⟨@var{exp}⟩)</code>, without using the
optimization provided by the <code>memo-proc</code> procedure described in 
3.5.1.</p>
<h5>Solution</h5>
<h4 id="exercise-358">Exercise 3.58</h4>
<p>Give an interpretation of the
stream computed by the following procedure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">expand</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="n">den</span><span class="w"> </span><span class="n">radix</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">   </span><span class="p">(</span><span class="nb">quotient</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="n">radix</span><span class="p">)</span><span class="w"> </span><span class="n">den</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="nb">expand</span><span class="w"> </span><span class="p">(</span><span class="nb">remainder</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="n">radix</span><span class="p">)</span><span class="w"> </span><span class="n">den</span><span class="p">)</span><span class="w"> </span>
<span class="w">           </span><span class="n">den</span><span class="w"> </span>
<span class="w">           </span><span class="n">radix</span><span class="p">)))</span>
</code></pre></div>

<p>(<code>Quotient</code> is a primitive that returns the integer quotient of two
integers.)  What are the successive elements produced by <code>(expand 1 7
10)</code>?  What is produced by <code>(expand 3 8 10)</code>?</p>
<h5>Solution</h5>
<h4 id="exercise-359">Exercise 3.59</h4>
<p>In 2.5.3 we saw how
to implement a polynomial arithmetic system representing polynomials as lists
of terms.  In a similar way, we can work with power series, such as</p>
<p>$$\begin{eqnarray}
  e^x     &amp;=&amp; 1 + x + \frac{1}{2} x^2  + \frac{1}{3 \cdot 2} x^3  + \frac{1}{4 \cdot 3 \cdot 2} x^4  + \dots, \
  \cos x  &amp;=&amp; 1 - \frac{1}{2} x^2  + \frac{1}{4 \cdot 3 \cdot 2} x^4  - \dots, \
  \sin x  &amp;=&amp; x - \frac{1}{3 \cdot 2} x^3  + \frac{1}{5 \cdot 4 \cdot 3 \cdot 2} x^5  - \dots
\end{eqnarray}
$$</p>
<p>represented as infinite streams.  We will represent the series ${a_0 +
a_1 x$ + {a_2 x^2} + {a_3 x^3 + \dots}} as the stream whose
elements are the coefficients $a_0$, $a_1$, $a_2$, $a_3$, @dots{}.</p>
<p><strong>1.</strong> The integral of the series ${a_0 + a_1 x$ + {a_2 x^2} + {a_3 x^3 + \dots}} is the series</p>
<p>$$c + {a_0 x} + {\frac{1}{2} a_1 x^2} + {\frac{1}{3} a_2 x^3} + {\frac{1}{4} a_3 x^4 + \dots,}  $$</p>
<p>where $c$ is any constant.  Define a procedure <code>integrate-series</code> that
takes as input a stream $a_0$, $a_1$, $a_2$, @dots{} representing a power
series and returns the stream $a_0$, ${{1\over2}a_1$}, ${{1\over3}a_2$}, @dots{} of
coefficients of the non-constant terms of the integral of the series.  (Since
the result has no constant term, it doesn't represent a power series; when we
use <code>integrate-series</code>, we will <code>cons</code> on the appropriate constant.)</p>
<p><strong>2.</strong> The function ${x \mapsto e^x$} is its own derivative.  This implies that
$e^x$ and the integral of $e^x$ are the same series, except for the
constant term, which is ${e^0 = 1$}.  Accordingly, we can generate the series
for $e^x$ as</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">exp-series</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">   </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">integrate-series</span><span class="w"> </span><span class="n">exp-series</span><span class="p">)))</span>
</code></pre></div>

<p>Show how to generate the series for sine and cosine, starting from the facts
that the derivative of sine is cosine and the derivative of cosine is the
negative of sine:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">cosine-series</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">sine-series</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="p">))</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-360">Exercise 3.60</h4>
<p>With power series represented as
streams of coefficients as in Exercise 3.59, adding series is implemented
by <code>add-streams</code>.  Complete the definition of the following procedure for
multiplying series:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">mul-series</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="p">(</span><span class="n">add-streams</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="w"> </span><span class="n">⟨??⟩</span><span class="p">)))</span>
</code></pre></div>

<p>You can test your procedure by verifying that ${\sin^2x + \cos^2x = 1,$}
using the series from Exercise 3.59.</p>
<h5>Solution</h5>
<h4 id="exercise-361">Exercise 3.61</h4>
<p>Let $S$ be a power series
(Exercise 3.59) whose constant term is 1.  Suppose we want to find the
power series ${1 / S$}, that is, the series $X$ such that ${SX = 1$}.
Write ${S = 1 + S_R$} where $S_R$ is the part of $S$ after the
constant term.  Then we can solve for $X$ as follows:</p>
<p>$$\begin{eqnarray}
  S \cdot X           &amp;=&amp;   1, \
  (1 + S_R) \cdot X   &amp;=&amp;   1, \
  X + S_R \cdot X     &amp;=&amp;   1, \
  X                   &amp;=&amp;   1 - S_R \cdot X.
\end{eqnarray}
$$</p>
<p>In other words, $X$ is the power series whose constant term is 1 and whose
higher-order terms are given by the negative of $S_R$ times $X$.  Use
this idea to write a procedure <code>invert-unit-series</code> that computes ${1 / S$}
for a power series $S$ with constant term 1.  You will need to use
<code>mul-series</code> from Exercise 3.60.</p>
<h5>Solution</h5>
<h4 id="exercise-362">Exercise 3.62</h4>
<p>Use the results of Exercise 3.60 
and Exercise 3.61 to define a procedure <code>div-series</code> that
divides two power series.  <code>Div-series</code> should work for any two series,
provided that the denominator series begins with a nonzero constant term.  (If
the denominator has a zero constant term, then <code>div-series</code> should signal
an error.)  Show how to use <code>div-series</code> together with the result of
Exercise 3.59 to generate the power series for tangent.</p>
<h5>Solution</h5>
<h4 id="exercise-363">Exercise 3.63</h4>
<p>Louis Reasoner asks why the
<code>sqrt-stream</code> procedure was not written in the following more
straightforward way, without the local variable <code>guesses</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">sqrt-stream</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">   </span><span class="mf">1.0</span>
<span class="w">   </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
<span class="w">                 </span><span class="p">(</span><span class="n">sqrt-improve</span><span class="w"> </span><span class="n">guess</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">               </span><span class="p">(</span><span class="n">sqrt-stream</span><span class="w"> </span><span class="n">x</span><span class="p">))))</span>
</code></pre></div>

<p>Alyssa P. Hacker replies that this version of the procedure is considerably
less efficient because it performs redundant computation.  Explain Alyssa's
answer.  Would the two versions still differ in efficiency if our
implementation of <code>delay</code> used only <code>(lambda () ⟨@var{exp}⟩)</code> without
using the optimization provided by <code>memo-proc</code> (3.5.1)?</p>
<h5>Solution</h5>
<h4 id="exercise-364">Exercise 3.64</h4>
<p>Write a procedure
<code>stream-limit</code> that takes as arguments a stream and a number (the
tolerance).  It should examine the stream until it finds two successive
elements that differ in absolute value by less than the tolerance, and return
the second of the two elements.  Using this, we could compute square roots up
to a given tolerance by</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="nb">sqrt</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">tolerance</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">stream-limit</span><span class="w"> </span><span class="p">(</span><span class="n">sqrt-stream</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">tolerance</span><span class="p">))</span>
</code></pre></div>

<h5>Solution</h5>
<h4 id="exercise-365">Exercise 3.65</h4>
<p>Use the series</p>
<p>$$\ln 2 \,=\, 1 - {1\over2} + {1\over3} - {1\over4} + \dots  $$</p>
<p>to compute three sequences of approximations to the natural logarithm of 2, in
the same way we did above for $\pi$.  How rapidly do these sequences
converge?</p>
<h5>Solution</h5>
<h4 id="exercise-366">Exercise 3.66</h4>
<p>Examine the stream <code>(pairs
integers integers)</code>. Can you make any general comments about the order in which
the pairs are placed into the stream? For example, approximately how many pairs precede
the pair (1, 100)?  the pair (99, 100)? the pair (100, 100)? (If you can make
precise mathematical statements here, all the better. But feel free to give
more qualitative answers if you find yourself getting bogged down.)</p>
<h5>Solution</h5>
<h4 id="exercise-367">Exercise 3.67</h4>
<p>Modify the <code>pairs</code> procedure
so that <code>(pairs integers integers)</code> will produce the stream of <em>all</em>
pairs of integers ${(i, j)$} (without the condition ${i \le j$}).  Hint:
You will need to mix in an additional stream.</p>
<h5>Solution</h5>
<h4 id="exercise-368">Exercise 3.68</h4>
<p>Louis Reasoner thinks that
building a stream of pairs from three parts is unnecessarily complicated.
Instead of separating the pair ${(S_0, T_0)$} from the rest of the pairs in
the first row, he proposes to work with the whole first row, as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">pairs</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">interleave</span>
<span class="w">   </span><span class="p">(</span><span class="nb">stream-map</span>
<span class="w">    </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">))</span>
<span class="w">    </span><span class="n">t</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">pairs</span><span class="w"> </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">          </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">t</span><span class="p">))))</span>
</code></pre></div>

<p>Does this work?  Consider what happens if we evaluate <code>(pairs integers
integers)</code> using Louis's definition of <code>pairs</code>.</p>
<h5>Solution</h5>
<h4 id="exercise-369">Exercise 3.69</h4>
<p>Write a procedure <code>triples</code>
that takes three infinite streams, $S$, $T$, and $U$, and produces the
stream of triples ${(S_i, T_j, U_k)$} such that ${i \le j \le k$}.<br />
Use <code>triples</code> to generate the stream of all Pythagorean
triples of positive integers, i.e., the triples ${(i, j, k)$} such that
${i \le j$} and ${i^2 + j^2 = k^2$}.</p>
<h5>Solution</h5>
<h4 id="exercise-370">Exercise 3.70</h4>
<p>It would be nice to be able to
generate streams in which the pairs appear in some useful order, rather than in
the order that results from an <em>ad hoc</em> interleaving process.  We can use
a technique similar to the <code>merge</code> procedure of Exercise 3.56, if we
define a way to say that one pair of integers is <code>less than'' another.  One
way to do this is to define a</code>weighting function'' ${W(i, j)$} and
stipulate that ${(i_1, j_1)$} is less than ${(i_2, j_2)$} if
${W(i_1, j_1) \lt$ {W(i_2, j_2)}}.  Write a procedure
<code>merge-weighted</code> that is like <code>merge</code>, except that
<code>merge-weighted</code> takes an additional argument <code>weight</code>, which is a
procedure that computes the weight of a pair, and is used to determine the
order in which elements should appear in the resulting merged
stream.  Using this, generalize <code>pairs</code> to a procedure
<code>weighted-pairs</code> that takes two streams, together with a procedure that
computes a weighting function, and generates the stream of pairs, ordered
according to weight.  Use your procedure to generate</p>
<p><strong>1.</strong> the stream of all pairs of positive integers ${(i, j)$} with ${i \le j$}
ordered according to the sum ${i + j$},</p>
<p><strong>2.</strong> the stream of all pairs of positive integers ${(i, j)$} with ${i \le j$},
where neither $i$ nor $j$ is divisible by 2, 3, or 5, and the pairs are
ordered according to the sum ${2i + 3j + 5ij$}.</p>
<h5>Solution</h5>
<h4 id="exercise-371">Exercise 3.71</h4>
<p>Numbers that can be expressed as
the sum of two cubes in more than one way are sometimes called
Ramanujan numbers, in honor of the mathematician Srinivasa
Ramanujan. Ordered streams of pairs provide an elegant
solution to the problem of computing these numbers.  To find a number that can
be written as the sum of two cubes in two different ways, we need only generate
the stream of pairs of integers ${(i, j)$} weighted according to the sum
${i^3 + j^3$} (see Exercise 3.70), then search the stream for two
consecutive pairs with the same weight.  Write a procedure to generate the
Ramanujan numbers.  The first such number is 1,729.  What are the next five?</p>
<h5>Solution</h5>
<h4 id="exercise-372">Exercise 3.72</h4>
<p>In a similar way to Exercise 3.71 
generate a stream of all numbers that can be written as the sum of two
squares in three different ways (showing how they can be so written).</p>
<h5>Solution</h5>
<h4 id="exercise-373">Exercise 3.73</h4>
<p>We can model electrical circuits
using streams to represent the values of currents or voltages at a sequence of
times.  For instance, suppose we have an RC circuit consisting of a
resistor of resistance $R$ and a capacitor of capacitance $C$ in series.
The voltage response $v$ of the circuit to an injected current $i$ is
determined by the formula in Figure 3.33, whose structure is shown by the
accompanying signal-flow diagram.</p>
<p>@float
@anchor{Figure 3.33}</p>
<p>@iftex
<img alt="Image: fig/chap3/Fig3.33a,125mm,,,.std.svg" src="/images/sicp/fig/chap3/Fig3.33a,125mm,,,.std.svg.png" />
@caption{@strong{Figure 3.33:} An RC circuit and the associated signal-flow diagram.}</p>
<p>Write a procedure <code>RC</code> that models this circuit.  <code>RC</code> should take as
inputs the values of $R$, $C$, and ${dt$} and should return a procedure
that takes as inputs a stream representing the current $i$ and an initial
value for the capacitor voltage $v_0$ and produces as output the stream of
voltages $v$.  For example, you should be able to use <code>RC</code> to model an
RC circuit with $R$ = 5 ohms, $C$ = 1 farad, and a 0.5-second time step by
evaluating <code>(define RC1 (RC 5 1 0.5))</code>.  This defines <code>RC1</code> as a
procedure that takes a stream representing the time sequence of currents and an
initial capacitor voltage and produces the output stream of voltages.</p>
<h5>Solution</h5>
<h4 id="exercise-374">Exercise 3.74</h4>
<p>Alyssa P. Hacker is designing a
system to process signals coming from physical sensors.  One important feature
she wishes to produce is a signal that describes the zero crossings
of the input signal.  That is, the resulting signal should be ${+1$} whenever the
input signal changes from negative to positive, ${-1$} whenever the input signal
changes from positive to negative, and $0$ otherwise.  (Assume that the sign of a
$0$ input is positive.)  For example, a typical input signal with its associated
zero-crossing signal would be</p>
<div class="codehilite"><pre><span></span><code><span class="n">@r</span><span class="p">{</span><span class="n">…</span><span class="p">}</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mf">1.5</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="mf">-0.1</span><span class="w"> </span><span class="mi">-2</span><span class="w"> </span><span class="mi">-3</span><span class="w"> </span><span class="mi">-2</span><span class="w"> </span><span class="mf">-0.5</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">@r</span><span class="p">{</span><span class="n">…</span><span class="p">}</span>
<span class="n">@r</span><span class="p">{</span><span class="n">…</span><span class="p">}</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">-1</span><span class="w">   </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span><span class="w">   </span><span class="mi">1</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">@r</span><span class="p">{</span><span class="n">…</span><span class="p">}</span>
</code></pre></div>

<p>In Alyssa's system, the signal from the sensor is represented as a stream
<code>sense-data</code> and the stream <code>zero-crossings</code> is the corresponding
stream of zero crossings.  Alyssa first writes a procedure
<code>sign-change-detector</code> that takes two values as arguments and compares the
signs of the values to produce an appropriate $0$, $1$, or ${-1$}.  She then
constructs her zero-crossing stream as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-zero-crossings</span>
<span class="w">         </span><span class="n">input-stream</span><span class="w"> </span><span class="n">last-value</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span>
<span class="w">   </span><span class="p">(</span><span class="n">sign-change-detector</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">input-stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">last-value</span><span class="p">)</span>
<span class="w">   </span><span class="p">(</span><span class="n">make-zero-crossings</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">input-stream</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">input-stream</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">zero-crossings</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="n">make-zero-crossings</span><span class="w"> </span><span class="n">sense-data</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
</code></pre></div>

<p>Alyssa's boss, Eva Lu Ator, walks by and suggests that this program is
approximately equivalent to the following one, which uses the generalized
version of <code>stream-map</code> from Exercise 3.50:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="n">zero-crossings</span>
<span class="w">  </span><span class="p">(</span><span class="nb">stream-map</span><span class="w"> </span><span class="n">sign-change-detector</span><span class="w"> </span>
<span class="w">              </span><span class="n">sense-data</span><span class="w"> </span>
<span class="w">              </span><span class="n">⟨@var</span><span class="p">{</span><span class="n">expression</span><span class="p">}</span><span class="n">⟩</span><span class="p">))</span>
</code></pre></div>

<p>Complete the program by supplying the indicated <code>⟨</code>@var{expression}<code>⟩</code>.</p>
<h5>Solution</h5>
<h4 id="exercise-375">Exercise 3.75</h4>
<p>Unfortunately, Alyssa's
zero-crossing detector in Exercise 3.74 proves to be insufficient,
because the noisy signal from the sensor leads to spurious zero crossings.  Lem
E.  Tweakit, a hardware specialist, suggests that Alyssa smooth the signal to
filter out the noise before extracting the zero crossings.  Alyssa takes his
advice and decides to extract the zero crossings from the signal constructed by
averaging each value of the sense data with the previous value.  She explains
the problem to her assistant, Louis Reasoner, who attempts to implement the
idea, altering Alyssa's program as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">make-zero-crossings</span><span class="w"> </span>
<span class="w">         </span><span class="n">input-stream</span><span class="w"> </span><span class="n">last-value</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="n">avpt</span><span class="w"> </span>
<span class="w">         </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">input-stream</span><span class="p">)</span><span class="w"> </span>
<span class="w">               </span><span class="n">last-value</span><span class="p">)</span><span class="w"> </span>
<span class="w">            </span><span class="mi">2</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">     </span><span class="p">(</span><span class="n">sign-change-detector</span><span class="w"> </span><span class="n">avpt</span><span class="w"> </span><span class="n">last-value</span><span class="p">)</span>
<span class="w">     </span><span class="p">(</span><span class="n">make-zero-crossings</span><span class="w"> </span>
<span class="w">      </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">input-stream</span><span class="p">)</span><span class="w"> </span><span class="n">avpt</span><span class="p">))))</span>
</code></pre></div>

<p>This does not correctly implement Alyssa's plan.  Find the bug that Louis has
installed and fix it without changing the structure of the program.  (Hint: You
will need to increase the number of arguments to <code>make-zero-crossings</code>.)</p>
<h5>Solution</h5>
<h4 id="exercise-376">Exercise 3.76</h4>
<p>Eva Lu Ator has a criticism of
Louis's approach in Exercise 3.75.  The program he wrote is not modular,
because it intermixes the operation of smoothing with the zero-crossing
extraction.  For example, the extractor should not have to be changed if Alyssa
finds a better way to condition her input signal.  Help Louis by writing a
procedure <code>smooth</code> that takes a stream as input and produces a stream in
which each element is the average of two successive input stream elements.
Then use <code>smooth</code> as a component to implement the zero-crossing detector
in a more modular style.</p>
<h5>Solution</h5>
<h4 id="exercise-377">Exercise 3.77</h4>
<p>The <code>integral</code> procedure
used above was analogous to the <code>`implicit'' definition of the infinite stream
of integers in 3.5.2.  Alternatively, we can give a definition of</code>integral<code>that is more like</code>integers-starting-from` (also in
3.5.2):</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="k">define</span><span class="w"> </span><span class="p">(</span><span class="n">integral</span>
<span class="w">         </span><span class="n">integrand</span><span class="w"> </span><span class="n">initial-value</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>
<span class="w">  </span><span class="p">(</span><span class="n">cons-stream</span><span class="w"> </span>
<span class="w">   </span><span class="n">initial-value</span>
<span class="w">   </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stream-null?</span><span class="w"> </span><span class="n">integrand</span><span class="p">)</span>
<span class="w">       </span><span class="n">the-empty-stream</span>
<span class="w">       </span><span class="p">(</span><span class="n">integral</span><span class="w"> </span>
<span class="w">        </span><span class="p">(</span><span class="n">stream-cdr</span><span class="w"> </span><span class="n">integrand</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="p">(</span><span class="n">stream-car</span><span class="w"> </span><span class="n">integrand</span><span class="p">))</span>
<span class="w">           </span><span class="n">initial-value</span><span class="p">)</span>
<span class="w">        </span><span class="n">dt</span><span class="p">))))</span>
</code></pre></div>

<p>When used in systems with loops, this procedure has the same problem as does
our original version of <code>integral</code>.  Modify the procedure so that it
expects the <code>integrand</code> as a delayed argument and hence can be used in the
<code>solve</code> procedure shown above.</p>
<h5>Solution</h5>
<h4 id="exercise-378">Exercise 3.78</h4>
<p>Consider the problem of designing
a signal-processing system to study the homogeneous second-order linear
differential equation</p>
<p>$$\frac{d^2 y}{dt^2} - {a \frac{dy}{dt}} - {by} \,=\, {0.}  $$</p>
<p>The output stream, modeling $y$, is generated by a network that contains a
loop. This is because the value of ${d^2 y / dt^2$} depends upon the
values of $y$ and ${dy / dt$} and both of these are determined by
integrating ${d^2 y / dt^2$}.  The diagram we would like to encode is
shown in Figure 3.35.  Write a procedure <code>solve-2nd</code> that takes as
arguments the constants $a$, $b$, and ${dt$} and the initial values
$y_0$ and ${dy_0$} for $y$ and ${dy / dt$} and generates the
stream of successive values of $y$.</p>
<h5>Solution</h5>
<h4 id="exercise-379">Exercise 3.79</h4>
<p>Generalize the <code>solve-2nd</code>
procedure of Exercise 3.78 so that it can be used to solve general
second-order differential equations ${d^2 y / dt^2$ =
{f(dy / dt, y)}}.</p>
<h5>Solution</h5>
<h4 id="exercise-380">Exercise 3.80</h4>
<p>A series RLC circuit
consists of a resistor, a capacitor, and an inductor connected in series, as
shown in Figure 3.36.  If $R$, $L$, and $C$ are the resistance,
inductance, and capacitance, then the relations between voltage ${(v)$} and
current ${(i)$} for the three components are described by the equations</p>
<p>$$\begin{eqnarray}
  v_R   &amp;=&amp;   i_R R, \
  v_L   &amp;=&amp;   L\,{di_L \over dt}, \
  i_C   &amp;=&amp;   C\,{dv_C \over dt},
\end{eqnarray}
$$</p>
<p>and the circuit connections dictate the relations</p>
<p>$$\begin{eqnarray}
  i_R   &amp;=&amp;   i_L = -i_C, \
  v_C   &amp;=&amp;   v_L + v_R.
\end{eqnarray}
$$</p>
<p>Combining these equations shows that the state of the circuit (summarized by
$v_C$, the voltage across the capacitor, and $i_L$, the current in
the inductor) is described by the pair of differential equations</p>
<p>$$\begin{eqnarray}
  {dv_C \over dt}   &amp;=&amp;   -{i_L \over C}\,, \
  {di_L \over dt}   &amp;=&amp;    {1 \over L}\, v_C - {R \over L}\, i_L.
\end{eqnarray}
$$</p>
<p>The signal-flow diagram representing this system of differential equations is
shown in Figure 3.37.</p>
<h5>Solution</h5>
<h4 id="exercise-381">Exercise 3.81</h4>
<p>Exercise 3.6 discussed
generalizing the random-number generator to allow one to reset the
random-number sequence so as to produce repeatable sequences of <code>`random''
numbers.  Produce a stream formulation of this same generator that operates on
an input stream of requests to</code>generate<code>a new random number or to</code>reset` the sequence to a specified value and that produces the desired
stream of random numbers.  Don't use assignment in your solution.</p>
<h5>Solution</h5>
<h4 id="exercise-382">Exercise 3.82</h4>
<p>Redo Exercise 3.5 on Monte
Carlo integration in terms of streams.  The stream version of
<code>estimate-integral</code> will not have an argument telling how many trials to
perform.  Instead, it will produce a stream of estimates based on successively
more trials.</p>
<h5>Solution</h5>
    </div>
</body>
</html>
